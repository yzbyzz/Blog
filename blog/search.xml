<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[《编写可读代码的艺术》 MinuteHourCounter]]></title>
    <url>%2Fblog%2F2017%2F08%2F09%2F%E7%BC%96%E5%86%99%E5%8F%AF%E8%AF%BB%E4%BB%A3%E7%A0%81%E7%9A%84%E8%89%BA%E6%9C%AF-MinuteHourCounter%2F</url>
    <content type="text"><![CDATA[一个 MinuteHourCounter （分钟/小时计数器），用于统计过去一段时间内某事发生的频次。下面是《编写可读代码的艺术》中的几种实现方式。 1：一个幼稚的方案 每当事件发生时，将其（时间，频次）的元祖放入列表中。每次统计时，计算相应事件段内的频次之和。 123456789101112131415161718192021222324252627282930313233class MinuterHourCounter &#123; struct Event &#123; Event(int count, time_t time) : count(count), time(time) &#123;&#125; int count; time_t time; &#125; list&lt;Event&gt; events;public: void Add(int count) &#123; events.push_back(Event(count, time())); &#125; int MinuteCount() &#123; int count = 0; const time_t now_secs = time(); for (list&lt;Event&gt;::reverse_iterator i = events.rbegin(); i != events.rend() &amp;&amp; i-&gt;time &gt; now_secs - 60; ++i) &#123; count += i-&gt;count; &#125; return count; &#125; int HourCount() &#123; int count = 0; const time_t now_secs = time(); for (list&lt;Event&gt;::reverse_iterator i = events.rbegin(); i != events.rend() &amp;&amp; i-&gt;time &gt; now_secs - 3600; ++i) &#123; count += i-&gt;count; &#125; return count; &#125;&#125; 一个更易读的版本 抽离了 MinuteCount 和 HourCount 相同的部分 迭代器变量使用了更常用的名字 将条件判断从循环中抽取出来 123456789101112131415161718192021222324252627282930313233class MinuterHourCounter &#123; struct Event &#123; Event(int count, time_t time) : count(count), time(time) &#123;&#125; int count; time_t time; &#125; list&lt;Event&gt; events; int CountSince(time_t cutoff) &#123; int count = 0; for (list&lt;Event&gt;::reverse_iterator rit = events.rbegin(); rit != events.rend(); ++rit) &#123; if (rit-&gt;time &lt;= cutoff) &#123; break; &#125; count += rit-&gt;count; &#125; return count; &#125;public: void Add(int count) &#123; events.push_back(Event(count, time())); &#125; int MinuteCount() &#123; return CountSince(time() - 60); &#125; int HourCount() &#123; return CountSince(time() - 3600); &#125;&#125; 性能问题 随着程序的不断运行，列表会占据大量的内存，而且其中大部分是无用的过期数据 MinuteCount() 和 HourCount() 的时间复杂度为 O(n) 2：传送带设计方案 删除不再需要的数据 更新事先算好的 minute_count 和 hour_count 变量 123456789101112131415161718192021222324252627282930313233343536373839class MinuteHourCounter &#123; list&lt;Event&gt; minute_events; list&lt;Event&gt; hour_events; // only contains elements NOT in minute_events int minute_count; int hour_count; void ShiftOldEvents(time_t now_secs) &#123; const int minute_ago = now_secs - 60; const int hour_ago = now_secs - 3600; while (!minute_events.empty() &amp;&amp; minute_events.front().time &lt;= minute_ago) &#123; hour_events.push_back(minute_events.front()); minuter &#125; &#125;public: void Add(int count) &#123; const time_t now_secs = time(); ShiftOldEvents(now_secs); minute_events.push_back(Event(count, now_secs)); minute_count += count; hour_count += count; &#125; int MinuteCount() &#123; ShiftOldEvents(time()); return minute_count; &#125; int HourCount() &#123; ShiftOldEvents(time()); return hour_count; &#125;&#125; 存在的问题 设计不灵活 内纯占用大 3：时间桶设计方案 把过去一段时间内发生的事件按照时间点装到桶里，该桶的值即为该时间上事件发生的频次 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879class ConveyorQueue &#123; queue&lt;int&gt; q; int max_items; int total_sum;public: ConveyorQueue(int max_times) : max_items(max_items)， total_sum(0) &#123; &#125; void AddToBack(int count) &#123; if (q.empty()) Shift(1); q.back() += count; total_sum += count; &#125; void Shift(int num_shifted); int TotalSum();&#125;class TrailingBucketCounter &#123; ConveyorQueue buckets; const int secs_per_bucket; time_t last_update_time; void Update(time_t now) &#123; int current_bucket = now / secs_per_bucket; int last_update_bucket = last_update_time / secs_per_bucket; buckets.Shift(current_bucket - last_update_bucket); last_update_time = now; &#125;public: TrailingBucketCounter(int num_buckets, int secs_per_bucket) : buckets(num_buckets), secs_per_bucket(secs_per_bucket), last_update_time(time()) /*书里没有初始化*/ &#123; &#125; void Add(int count, time_t now) &#123; Update(now); buckets.AddToBack(count); &#125; int TrailingCount(time_t now) &#123; Update(now); return buckets.TotalSum(); &#125;&#125;class MinuteHourCounter &#123; TrailingBucketCounter minute_counts; TrailingBucketCounter hour_counts;public: MinuteHourCounter() : minute_counts(60, 1), hour_counts(60, 60) &#123; &#125; void Add(int count) &#123; time_t now = time(); minute_counts.Add(count, now); hour_counts.Add(count, now); &#125; int MinuteCount() &#123; time_t now = time(); return minute_counts.TrailingCount(now); &#125; int HourCount() &#123; time_t now = time(); return hour_counts.TrailingCount(now); &#125;&#125;]]></content>
      <categories>
        <category>码农的自我修养</category>
      </categories>
      <tags>
        <tag>优雅</tag>
        <tag>C++</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[香港贝澳营地&迪士尼]]></title>
    <url>%2Fblog%2F2017%2F07%2F10%2Fhongkong-beiao-disney%2F</url>
    <content type="text"><![CDATA[7月7日去了香港，9号回。在贝澳营地露营烧烤玩水，迪士尼玩了一天。做一点记录，也算作为一个攻略。 准备☆★ 表示推荐度，最高五星。 ★★★★★ 必备 ★★★★☆ 强烈推荐 ★★★☆☆ 推荐 ★★☆☆☆ 可以带 ★☆☆☆☆ 随便 必备 ★★★★★ 港澳通行证／身份证 ★★★★★ 港币，以备不时之需。大部分店能用银联(借记/信用)卡/支付宝/微信支付，但还是有一些地方只收现金。推荐尽量使用现金以外的付款方式，这样可以少换一点港币。 ★★★★★ 八达通。在香港地铁只能现金购买，要150港币，括50元押金和100元车费。如果只坐地铁，可以买地铁一日通/三日通等，相应时间内无限制坐地铁，但不能坐公交。然而去贝澳营地要坐公车….(八达通也可以过关前，在深圳这边先买好。) ★★★★★ 换洗衣物 ★★★★★ 洗漱用品 ★★★★★ 拖鞋 ★★★★★ 雨伞、帽子 ★★★★☆ 泳裤 ★★★☆☆ 泳帽、泳镜 扎营相关 ★★★★★ 帐篷、帆布。帆布有两个作用：帐篷可以一直留着门窗透气，晚上睡觉不会太闷；另外也能遮阳挡雨，不用一下雨就得躲进帐篷。 ★★★★★ 防潮垫/小毯子/大毛巾。沙滩地面不是很平整，而且略硬。 ★★★★☆ [充气]枕头、睡袋 ★★★☆☆ 吊床。晒太阳，发呆。 ★★★☆☆ 折叠凳子 ★★★★★ 移动电源。贝澳营地没有地方充电。所以带足充电宝。据说小卖部充电20$HK/次 ★★☆☆☆ 灯、光源、（充电式/手动档）风扇 食物相关 食材可以带过境，也可以在香港超市买；蔬菜/肉类不推荐带太多，毕竟没有冰箱不耐放。如果待的久，可以需要时去超市购买。 ★★★☆☆ 桶。方便用水，只推荐折叠桶，好带。 ★★★★☆ 面条、饺子 ★★★★☆ 蔬菜 ★★★★☆ 肉类 ★★★★★ 酒水，开瓶器 ★★★★★ 便携燃气炉、燃气罐、碳。这些东西过香港不查。如果是坐中旅大巴到香港就没什么问题；但如果是坐动车到深圳，能不能带上动车比较难说了，或者可以在深圳买 ★★★★★ 锅、烧烤架 ★★★★★ 一次性碗筷杯 Last But Not Least ★★★★★ 支付宝上“境外上网”可以买移动/联通的流量包，有1天/2天/3天等等，具体价格、激活方式看支付宝就清楚了。联通流量包需要提前购买 ★★★★★★★★★★ 妹子/汉子/基友/姬友/小朋友/大朋友。独乐乐不如众乐乐。 行程 大体说起来就是，周五坐大巴到香港，到贝澳营地登记、扎营、（雨中）烧烤；周六雨中畅游迪士尼；周日沙滩玩水，去市区吃个饭，然后就回广州了。 到达香港东涌 可以买中旅的大巴(广州&lt;-&gt;香港)往返票。（微信公众号：香港中旅粤港巴士。微信号：HKCTSBUS）。从广州坐到深圳湾过关，需要带行李下车，自行过关后，重新坐中旅的大巴，到香港荃湾下车，然后进地铁（如果没有八达通，可以在这里买），坐到荔景站，换线坐到东涌站。 也可以坐动车到深圳南站，在罗湖口岸过关，然后坐地铁到东涌。不过时间和金钱上不如上述方式。 东涌站外超市补充物资 如果物资齐备也可以跳过 地铁站出来就有超市，可以在这里买齐必须的物资，像是木炭，或者新鲜肉类，速冻饺子等 到达贝澳营地 东涌站外找到福东广场站，坐屿巴3M到新围村站下车 车上有几段路没有信号。一路上开始能看到大海的风景。 下车后，步行一千米左右到达贝澳营地大门，此处请善用导航/问路人 到达营地后，首先在门口管理处登记，得到营地使用权。 贝澳营地，有52个独立的营区，铁栅栏围起来，还有一套桌椅。 有香港身份证可以提前预约营地。不然就只能到达后用港澳通行证申请。 我们是周五晚上六七点到达，只剩下2个独立营区。 如果没有独立营区就只能去大草坪搭建帐篷，大草坪没有划分独立的空间。 周末才到，就可能没有独立营区。 十一长假到，很可能大草坪也没有多少位置。 营地完全免费！！！ 营地有专门供烧烤的地方，也有洗手间、换衣间、冲凉间（冲凉是半室外的！），小卖部（晚上好像没开，当然这里卖东西还是要钱的，而且比较贵）。 安营扎寨完毕，便可以生火烧烤、煮面下饺子。 酒足饭饱，洗漱完毕，在海浪声中入眠也是一种很不一样的体验 早上起来，在海边静静地聆听，边小酌几杯，别有一番滋味。 迪士尼 如果不想去迪士尼，可以继续在营地海边玩水 如果想去迪士尼，最好有3天以上的游玩时间，前后各一天可以安顿，中间有完整的1天逛迪士尼，门票才不会亏了 从营地出发，坐屿巴3M到东涌市中心站，进地铁站，坐到欣澳站，转迪士尼线到迪士尼站下车 出站就能看到迪士尼了 迪士尼门票可以在某宝或蚂蜂窝app（比某宝便宜）上买。 成人票是400+ 饭票是200（包括两张正餐券[一张需在16点前使用，一张需在16点后使用]，一张小吃券，一张打折券）。 迪士尼的几家餐厅都差不多，有中餐、牛排、日式拉面等套餐，标价是120+、140+港币不等。饭票的正餐券可以任选一个套餐，划算很多。 迪士尼进门的时候会搜包，不能带吃的，当然带瓶水还是可以的。 但是不搜身，身上带点零食还是可以的，要多带就得看神通了。 迪士尼很多项目都要排队，和项目好玩程度及项目花费时间成正比。 （所幸去的那天下阵雨了，天气比较凉爽。不然在烈日下排队还是一件比较郁闷的事。） 部分项目有一种称为FastPass的快捷通道：在该项目附近的机器处刷门票，会得到一张该项目的FastPass门票，上面有一个时间段，在该时间段来玩项目，不用排队，期间就可以去玩人比较少的项目，能省不少时间。需要注意FastPass领取要间隔一段时间。 一些游乐项目（可参考微信公众号“香港迪士尼乐园度假区”，微信号“HKDisneylandResort”，能看到节目时间表和一些介绍。另外进门不远就有园区介绍宣传单。） 太空飞碟室内过山车。配上机战的画面和音效，犹如身临其境。 灰熊山极速矿车室外过山车。有几段路是倒着开的。迪士尼的过山车倾斜角度都不会很大。 玩具兵团跳降伞固定座位，垂直上下，体验超重失重。 狮子王庆典 大型歌舞剧，时长半小时，英语对白，白话旁白，必看。每天有几场，具体时间以公众号或官网为准。 夜间巡游20：20开始。如果下雨就会取消。（当时就没看到sad） 烟花表演21：00，烟花在睡公主城堡，可在美国小镇大街观看。19：00开始，就陆续有人吃过晚餐在等了。椅子比较少，晚去就只能站着了，或者自带板凳。烟花效果很赞，有伴就更佳。 还有很多类似项目：室内，坐车，一路观赏各种不同景色、影片，某些时候，会有冷风、清水打到身上。不一一道来了。 总而言之，能玩一天体验了大部分项目的的话，门票还是不亏的。特别是有小孩/妹子（tan90°）的话怎么都不亏。 自行选择 继续迪士尼未完的项目。（那迪士尼门票记得买两日票，比两张单日票便宜） 继续玩水 到市区逛逛，买点东西，吃点美食 如果是坐大巴来回，记得选个方便的上车点，提前跟中旅说好地点和时间，然后到时间就可以悠哉地去坐大巴回家，结束这段别样的旅程。]]></content>
      <categories>
        <category>生活</category>
      </categories>
      <tags>
        <tag>香港</tag>
        <tag>旅游</tag>
        <tag>露营</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hello World]]></title>
    <url>%2Fblog%2F2017%2F05%2F09%2Fhello-world%2F</url>
    <content type="text"><![CDATA[有善始者实繁，能克终者盖寡。 又双叒叕开始写博客了。 不知道这次能坚持多久。 行百里者半九十，且行且珍惜。]]></content>
      <categories>
        <category>生活</category>
      </categories>
  </entry>
</search>